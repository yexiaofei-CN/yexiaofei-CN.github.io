---
title: 一条SQL查询语句是如何执行的
date: 2018-11-23 21:51:09
categories:
- Foo
- Bar
- Baz
---


标签（空格分隔）： MYSQL

---

> mysql> select * from T where ID=10；
这条语句的执行流程

MYSQL 基础架构图

![img](https://static001.geekbang.org/resource/image/0d/d9/0d2070e8f84c4801adbfa03bda1f98d9.png)

> MYSQL分为Server层和存储引擎层两部分。
> Server层包括连接器，查询缓存，分析器，优化器，执行器.

**连接器**
> 首先连接数据库这时候接待你的就是连接器，输完命令后，需要在交互对话里面输入密码，不要在-p后面输入密码，会导致密码泄露。

> *用户名密码通过，连接器会到权限表里面查出你拥有的权限。一个用户成功连接后，即使你用管理员账号对这个用户的权限做了修改，也不会影响已经存在连接的权限。

**全部使用长连接后，MYSQL占用内存涨的特别快，MYSQL在执行过程中临时使用的内存是管理在连接对象里面的。这些资源会在连接断开的时候才会释放。**
> * 定期断开长连接，使用一段时间，或者程序里面执行过一个占用内存的大查询后，断开连接，之后要查询在重连。
> * 如果使用MYSQL5.7或更新的版本，可以在每次执行一个比较大的操作后，通过执行mysql_reset_connection来重新初始化连接资源。这个过程不需要重连和重新做权限验证，但是会将连接恢复到刚刚创建完成的状态。

**查询缓存**
> * MYSQL拿到一个查询请求后，会先查询缓存，缓存有就返回。没有就会继续后面的执行阶段。

**分析器**
> * 分析器先做词法分析，输入的是由多个字符串和空格组成的sql语句，MYSQL需要识别出里面的字符串分别是什么？代表什么？
> * 在做语法分析，判断你输入的这个SQL语句是否满足MYSQL语法。

**优化器**
> * 优化器是在表里面有多个索引的时候，决定使用哪个索引，或者在一个语句有多表关联（join)的时候，决定各个表的连接顺序。

**执行器**
>* 前面的步骤完了之后，接下来就是执行了，执行器会判断该表有没有查询权限，如果没有就报错，有就去执行，打开表会根据表定义的引擎，会使用这个引擎提供的接口








